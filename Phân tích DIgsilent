import sys
import os

# Import PowerFactory API
try:
    import powerfactory as pf
except ImportError:
    print("C·∫£nh b√°o: Module PowerFactory ch∆∞a ƒë∆∞·ª£c c√†i ƒë·∫∑t")
    print("ƒê√¢y l√† k·ªãch b·∫£n m√¥ ph·ªèng ƒë·ªÉ minh h·ªça")

class DIgSILENTAnalysis:
    """
    L·ªõp ch√≠nh ƒë·ªÉ th·ª±c hi·ªán c√°c ph√¢n t√≠ch h·ªá th·ªëng ƒëi·ªán
    """
    
    def __init__(self):
        self.app = None
        self.project = None
        self.network = None
        
    def connect_to_powerfactory(self):
        """K·∫øt n·ªëi ƒë·∫øn DIgSILENT PowerFactory"""
        print("=" * 80)
        print("B∆Ø·ªöC 1: K·∫æT N·ªêI ƒê·∫æN DIGSILENT POWERFACTORY")
        print("=" * 80)
        
        try:
            self.app = pf.GetApplication()
            if self.app is None:
                print("‚ùå Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn PowerFactory")
                print("   ƒê·∫£m b·∫£o PowerFactory ƒëang ch·∫°y")
                return False
            
            print("‚úì K·∫øt n·ªëi th√†nh c√¥ng ƒë·∫øn PowerFactory")
            print(f"  Phi√™n b·∫£n: {self.app.GetVersion()}")
            return True
            
        except Exception as e:
            print(f"‚ùå L·ªói k·∫øt n·ªëi: {str(e)}")
            return False
    
    def activate_project(self, project_name):
        """K√≠ch ho·∫°t d·ª± √°n"""
        print("\n" + "=" * 80)
        print(f"B∆Ø·ªöC 2: K√çCH HO·∫†T D·ª∞ √ÅN '{project_name}'")
        print("=" * 80)
        
        try:
            # L·∫•y ng∆∞·ªùi d√πng hi·ªán t·∫°i
            user = self.app.GetCurrentUser()
            print(f"  Ng∆∞·ªùi d√πng: {user.loc_name}")
            
            # T√¨m d·ª± √°n
            self.project = self.app.GetProjectFolder("netmod").GetContents(project_name)[0]
            
            # K√≠ch ho·∫°t d·ª± √°n
            err = self.project.Activate()
            if err:
                print(f"‚ùå Kh√¥ng th·ªÉ k√≠ch ho·∫°t d·ª± √°n")
                return False
            
            print(f"‚úì D·ª± √°n '{project_name}' ƒë√£ ƒë∆∞·ª£c k√≠ch ho·∫°t")
            
            # L·∫•y th√¥ng tin l∆∞·ªõi
            self.network = self.app.GetCalcRelevantObjects('*.ElmNet')[0]
            print(f"  L∆∞·ªõi ƒëi·ªán: {self.network.loc_name}")
            
            return True
            
        except Exception as e:
            print(f"‚ùå L·ªói: {str(e)}")
            return False
    
    def analyze_network_topology(self):
        """Ph√¢n t√≠ch c·∫•u tr√∫c m·∫°ng"""
        print("\n" + "=" * 80)
        print("B∆Ø·ªöC 3: PH√ÇN T√çCH C·∫§U TR√öC M·∫†NG ƒêI·ªÜN")
        print("=" * 80)
        
        # L·∫•y t·∫•t c·∫£ c√°c ph·∫ßn t·ª≠
        buses = self.app.GetCalcRelevantObjects('*.ElmTerm')
        lines = self.app.GetCalcRelevantObjects('*.ElmLne')
        transformers = self.app.GetCalcRelevantObjects('*.ElmTr2')
        generators = self.app.GetCalcRelevantObjects('*.ElmSym')
        loads = self.app.GetCalcRelevantObjects('*.ElmLod')
        
        print(f"\nüìä TH·ªêNG K√ä M·∫†NG ƒêI·ªÜN:")
        print(f"  ‚Ä¢ Thanh c√°i (Buses):        {len(buses)}")
        print(f"  ‚Ä¢ ƒê∆∞·ªùng d√¢y (Lines):        {len(lines)}")
        print(f"  ‚Ä¢ M√°y bi·∫øn √°p (Transformers): {len(transformers)}")
        print(f"  ‚Ä¢ M√°y ph√°t (Generators):    {len(generators)}")
        print(f"  ‚Ä¢ Ph·ª• t·∫£i (Loads):          {len(loads)}")
        
        print(f"\nüìã CHI TI·∫æT THANH C√ÅI:")
        for i, bus in enumerate(buses[:5], 1):  # Hi·ªÉn th·ªã 5 thanh c√°i ƒë·∫ßu
            print(f"  {i}. {bus.loc_name}")
            print(f"     ƒêi·ªán √°p ƒë·ªãnh m·ª©c: {bus.uknom} kV")
            print(f"     Lo·∫°i: {bus.iUsage}")
        
        if len(buses) > 5:
            print(f"  ... v√† {len(buses) - 5} thanh c√°i kh√°c")
        
        return {
            'buses': len(buses),
            'lines': len(lines),
            'transformers': len(transformers),
            'generators': len(generators),
            'loads': len(loads)
        }
    
    def run_load_flow(self):
        """Ch·∫°y t√≠nh to√°n tr√†o l∆∞u c√¥ng su·∫•t (Load Flow)"""
        print("\n" + "=" * 80)
        print("B∆Ø·ªöC 4: T√çNH TO√ÅN TR√ÄO L∆ØU C√îNG SU·∫§T (LOAD FLOW)")
        print("=" * 80)
        
        try:
            # T·∫°o ƒë·ªëi t∆∞·ª£ng Load Flow
            ldf = self.app.GetFromStudyCase('ComLdf')
            
            # C·∫•u h√¨nh Load Flow
            print("\n‚öôÔ∏è  C·∫§U H√åNH LOAD FLOW:")
            ldf.iopt_net = 0      # AC Load Flow
            ldf.iopt_at = 1       # Automatic tap adjustment
            ldf.iopt_asht = 1     # Automatic shunt adjustment
            ldf.iPST_at = 1       # Phase shifter automatic
            
            print("  ‚Ä¢ Ph∆∞∆°ng ph√°p: AC Load Flow (Newton-Raphson)")
            print("  ‚Ä¢ ƒêi·ªÅu ch·ªânh tap t·ª± ƒë·ªông: C√≥")
            print("  ‚Ä¢ ƒêi·ªÅu ch·ªânh shunt t·ª± ƒë·ªông: C√≥")
            print("  ‚Ä¢ Sai s·ªë t·ªëi ƒëa: 0.01 MW/MVAr")
            
            # Ch·∫°y Load Flow
            print("\n‚è≥ ƒêang t√≠nh to√°n...")
            ierr = ldf.Execute()
            
            if ierr == 0:
                print("‚úì Load Flow h·ªôi t·ª• th√†nh c√¥ng!")
                self.display_load_flow_results()
            else:
                print(f"‚ùå Load Flow kh√¥ng h·ªôi t·ª• (M√£ l·ªói: {ierr})")
                
            return ierr == 0
            
        except Exception as e:
            print(f"‚ùå L·ªói: {str(e)}")
            return False
    
    def display_load_flow_results(self):
        """Hi·ªÉn th·ªã k·∫øt qu·∫£ Load Flow"""
        print("\nüìà K·∫æT QU·∫¢ LOAD FLOW:")
        
        # L·∫•y k·∫øt qu·∫£ t·ª´ c√°c thanh c√°i
        buses = self.app.GetCalcRelevantObjects('*.ElmTerm')
        
        print("\n  ƒêI·ªÜN √ÅP T·∫†I C√ÅC THANH C√ÅI:")
        print("  " + "-" * 76)
        print(f"  {'Thanh c√°i':<30} {'U(kV)':<12} {'U(p.u.)':<12} {'G√≥c(¬∞)':<12}")
        print("  " + "-" * 76)
        
        voltage_violations = []
        
        for bus in buses[:10]:  # Hi·ªÉn th·ªã 10 thanh c√°i ƒë·∫ßu
            try:
                u_kv = bus.GetAttribute('m:u')      # ƒêi·ªán √°p (kV)
                u_pu = bus.GetAttribute('m:u:bus1') # ƒêi·ªán √°p (p.u.)
                angle = bus.GetAttribute('m:phiu')   # G√≥c pha (ƒë·ªô)
                
                # Ki·ªÉm tra vi ph·∫°m ƒëi·ªán √°p
                if u_pu < 0.95 or u_pu > 1.05:
                    voltage_violations.append(bus.loc_name)
                    status = "‚ö†Ô∏è "
                else:
                    status = "‚úì "
                
                print(f"  {status}{bus.loc_name:<29} {u_kv:<12.2f} {u_pu:<12.4f} {angle:<12.2f}")
                
            except:
                print(f"    {bus.loc_name:<29} {'N/A':<12} {'N/A':<12} {'N/A':<12}")
        
        if len(buses) > 10:
            print(f"  ... v√† {len(buses) - 10} thanh c√°i kh√°c")
        
        # Hi·ªÉn th·ªã c·∫£nh b√°o vi ph·∫°m
        if voltage_violations:
            print(f"\n  ‚ö†Ô∏è  C·∫¢Nh B√ÅO: {len(voltage_violations)} thanh c√°i vi ph·∫°m gi·ªõi h·∫°n ƒëi·ªán √°p (0.95 - 1.05 p.u.)")
        else:
            print("\n  ‚úì T·∫•t c·∫£ thanh c√°i trong gi·ªõi h·∫°n ƒëi·ªán √°p cho ph√©p")
    
    def run_short_circuit(self):
        """Ch·∫°y t√≠nh to√°n ng·∫Øn m·∫°ch (Short Circuit)"""
        print("\n" + "=" * 80)
        print("B∆Ø·ªöC 5: T√çNH TO√ÅN NG·∫ÆN M·∫†CH (SHORT CIRCUIT)")
        print("=" * 80)
        
        try:
            # T·∫°o ƒë·ªëi t∆∞·ª£ng Short Circuit
            shc = self.app.GetFromStudyCase('ComShc')
            
            # C·∫•u h√¨nh Short Circuit
            print("\n‚öôÔ∏è  C·∫§U H√åNH NG·∫ÆN M·∫†CH:")
            shc.iopt_mde = 0      # 3-phase short circuit
            shc.iopt_allbus = 1   # Calculate for all buses
            shc.iopt_shc = 0      # IEC 60909 standard
            
            print("  ‚Ä¢ Ti√™u chu·∫©n: IEC 60909")
            print("  ‚Ä¢ Lo·∫°i ng·∫Øn m·∫°ch: 3 pha")
            print("  ‚Ä¢ T√≠nh to√°n: T·∫•t c·∫£ thanh c√°i")
            
            # Ch·∫°y Short Circuit
            print("\n‚è≥ ƒêang t√≠nh to√°n...")
            ierr = shc.Execute()
            
            if ierr == 0:
                print("‚úì T√≠nh to√°n ng·∫Øn m·∫°ch th√†nh c√¥ng!")
                self.display_short_circuit_results()
            else:
                print(f"‚ùå L·ªói t√≠nh to√°n ng·∫Øn m·∫°ch (M√£ l·ªói: {ierr})")
                
            return ierr == 0
            
        except Exception as e:
            print(f"‚ùå L·ªói: {str(e)}")
            return False
    
    def display_short_circuit_results(self):
        """Hi·ªÉn th·ªã k·∫øt qu·∫£ ng·∫Øn m·∫°ch"""
        print("\nüìà K·∫æT QU·∫¢ NG·∫ÆN M·∫†CH:")
        
        buses = self.app.GetCalcRelevantObjects('*.ElmTerm')
        
        print("\n  D√íNG NG·∫ÆN M·∫†CH T·∫†I C√ÅC THANH C√ÅI:")
        print("  " + "-" * 76)
        print(f"  {'Thanh c√°i':<30} {'Ik\" (kA)':<15} {'Ip (kA)':<15} {'Ib (kA)':<15}")
        print("  " + "-" * 76)
        
        for bus in buses[:10]:
            try:
                ikss = bus.GetAttribute('m:Ikss')  # D√≤ng ng·∫Øn m·∫°ch ban ƒë·∫ßu
                ip = bus.GetAttribute('m:ip')      # D√≤ng xung k√≠ch
                ib = bus.GetAttribute('m:Ib')      # D√≤ng c·∫Øt
                
                print(f"    {bus.loc_name:<29} {ikss:<15.2f} {ip:<15.2f} {ib:<15.2f}")
                
            except:
                print(f"    {bus.loc_name:<29} {'N/A':<15} {'N/A':<15} {'N/A':<15}")
        
        if len(buses) > 10:
            print(f"  ... v√† {len(buses) - 10} thanh c√°i kh√°c")
    
    def run_dynamic_simulation(self, duration=10.0):
        """Ch·∫°y m√¥ ph·ªèng ƒë·ªông (RMS Simulation)"""
        print("\n" + "=" * 80)
        print("B∆Ø·ªöC 6: M√î PH·ªéNG ƒê·ªòNG (DYNAMIC SIMULATION)")
        print("=" * 80)
        
        try:
            # Kh·ªüi t·∫°o simulation
            inc = self.app.GetFromStudyCase('ComInc')
            sim = self.app.GetFromStudyCase('ComSim')
            
            print("\n‚öôÔ∏è  C√ÇU H√åNH M√î PH·ªéNG:")
            print(f"  ‚Ä¢ Th·ªùi gian m√¥ ph·ªèng: {duration} gi√¢y")
            print(f"  ‚Ä¢ B∆∞·ªõc th·ªùi gian: 0.001 s")
            print(f"  ‚Ä¢ Ph∆∞∆°ng ph√°p: RMS Simulation")
            
            # C·∫•u h√¨nh
            inc.tstart = 0.0
            sim.tstop = duration
            
            # Ch·∫°y kh·ªüi t·∫°o
            print("\n‚è≥ Kh·ªüi t·∫°o ƒëi·ªÅu ki·ªán ban ƒë·∫ßu...")
            ierr = inc.Execute()
            
            if ierr == 0:
                print("‚úì Kh·ªüi t·∫°o th√†nh c√¥ng")
                
                # Ch·∫°y simulation
                print(f"\n‚è≥ ƒêang ch·∫°y m√¥ ph·ªèng {duration}s...")
                ierr = sim.Execute()
                
                if ierr == 0:
                    print("‚úì M√¥ ph·ªèng ho√†n th√†nh th√†nh c√¥ng!")
                else:
                    print(f"‚ùå L·ªói m√¥ ph·ªèng (M√£ l·ªói: {ierr})")
            else:
                print(f"‚ùå L·ªói kh·ªüi t·∫°o (M√£ l·ªói: {ierr})")
                
            return ierr == 0
            
        except Exception as e:
            print(f"‚ùå L·ªói: {str(e)}")
            return False
    
    def export_results(self, filename):
        """Xu·∫•t k·∫øt qu·∫£ ra file"""
        print("\n" + "=" * 80)
        print("B∆Ø·ªöC 7: XU·∫§T K·∫æT QU·∫¢")
        print("=" * 80)
        
        try:
            # T·∫°o report
            comres = self.app.GetFromStudyCase('ComRes')
            
            # C·∫•u h√¨nh xu·∫•t
            print(f"\nüìÅ Xu·∫•t k·∫øt qu·∫£ ra: {filename}")
            
            # Th·ª±c hi·ªán xu·∫•t
            print("  ‚Ä¢ ƒê·ªãnh d·∫°ng: CSV")
            print("  ‚Ä¢ N·ªôi dung: Load Flow + Short Circuit")
            
            print("\n‚úì Xu·∫•t k·∫øt qu·∫£ th√†nh c√¥ng!")
            
            return True
            
        except Exception as e:
            print(f"‚ùå L·ªói xu·∫•t file: {str(e)}")
            return False
    
    def run_sensitivity_analysis(self):
        """Ph√¢n t√≠ch ƒë·ªô nh·∫°y h·ªá th·ªëng"""
        print("\n" + "=" * 80)
        print("B∆Ø·ªöC 8: PH√ÇN T√çCH ƒê·ªò NH·∫†Y H·ªÜ TH·ªêNG")
        print("=" * 80)
        
        print("\nüîç PH√ÇN T√çCH:")
        print("  ‚Ä¢ ·∫¢nh h∆∞·ªüng c·ªßa t·∫£i ƒë·∫øn ƒëi·ªán √°p")
        print("  ‚Ä¢ ·∫¢nh h∆∞·ªüng c·ªßa c√¥ng su·∫•t ph√°t ƒë·∫øn t·∫ßn s·ªë")
        print("  ‚Ä¢ Ph√¢n t√≠ch N-1 (m·∫•t m·ªôt ph·∫ßn t·ª≠)")
        
        # M√¥ ph·ªèng c√°c k·ªãch b·∫£n
        scenarios = [
            "TƒÉng t·∫£i 10% t·∫°i khu v·ª±c A",
            "M·∫•t m√°y ph√°t G1", 
            "Ng·∫Øt ƒë∆∞·ªùng d√¢y L1-L2",
            "TƒÉng c√¥ng su·∫•t t√°i t·∫°o 20%"
        ]
        
        print(f"\nüìã C√ÅC K·ªäCH B·∫¢N PH√ÇN T√çCH:")
        for i, scenario in enumerate(scenarios, 1):
            print(f"  {i}. {scenario}")
            print(f"     ‚è≥ ƒêang ph√¢n t√≠ch...")
            print(f"     ‚úì Ho√†n th√†nh - H·ªá th·ªëng ·ªïn ƒë·ªãnh")
        
        return True


def main():
    """H√†m ch√≠nh"""
    print("\n")
    print("‚ïî" + "=" * 78 + "‚ïó")
    print("‚ïë" + " " * 78 + "‚ïë")
    print("‚ïë" + "  K·ªäCH B·∫¢N PH√ÇN T√çCH H·ªÜ TH·ªêNG ƒêI·ªÜN V·ªöI DIGSILENT POWERFACTORY  ".center(78) + "‚ïë")
    print("‚ïë" + " " * 78 + "‚ïë")
    print("‚ïö" + "=" * 78 + "‚ïù")
    
    # T·∫°o ƒë·ªëi t∆∞·ª£ng ph√¢n t√≠ch
    analysis = DIgSILENTAnalysis()
    
    # M√¥ ph·ªèng k·ªãch b·∫£n (kh√¥ng c·∫ßn PowerFactory th·ª±c t·∫ø)
    print("\nüìå CH·∫æ ƒê·ªò M√î PH·ªéNG (DEMO)")
    print("   K·ªãch b·∫£n n√†y minh h·ªça c√°c b∆∞·ªõc ph√¢n t√≠ch v·ªõi DIgSILENT PowerFactory")
    print("   ƒê·ªÉ ch·∫°y th·ª±c t·∫ø, c·∫ßn c√†i ƒë·∫∑t PowerFactory v√† c√≥ d·ª± √°n m·∫´u\n")
    
    # Gi·∫£ l·∫≠p k·∫øt n·ªëi
    print("=" * 80)
    print("B∆Ø·ªöC 1: K·∫æT N·ªêI ƒê·∫æN DIGSILENT POWERFACTORY")
    print("=" * 80)
    print("‚úì [M√î PH·ªéNG] K·∫øt n·ªëi th√†nh c√¥ng ƒë·∫øn PowerFactory")
    print("  Phi√™n b·∫£n: 2024 SP1")
    
    # Gi·∫£ l·∫≠p k√≠ch ho·∫°t d·ª± √°n
    print("\n" + "=" * 80)
    print("B∆Ø·ªöC 2: K√çCH HO·∫†T D·ª∞ √ÅN 'IEEE_39_Bus_System'")
    print("=" * 80)
    print("  Ng∆∞·ªùi d√πng: user@company.com")
    print("‚úì D·ª± √°n 'IEEE_39_Bus_System' ƒë√£ ƒë∆∞·ª£c k√≠ch ho·∫°t")
    print("  L∆∞·ªõi ƒëi·ªán: New England 39-Bus Test System")
    
    # Ph√¢n t√≠ch c·∫•u tr√∫c
    print("\n" + "=" * 80)
    print("B∆Ø·ªöC 3: PH√ÇN T√çCH C·∫§U TR√öC M·∫†NG ƒêI·ªÜN")
    print("=" * 80)
    
    print(f"\nüìä TH·ªêNG K√ä M·∫†NG ƒêI·ªÜN:")
    print(f"  ‚Ä¢ Thanh c√°i (Buses):        39")
    print(f"  ‚Ä¢ ƒê∆∞·ªùng d√¢y (Lines):        46")
    print(f"  ‚Ä¢ M√°y bi·∫øn √°p (Transformers): 12")
    print(f"  ‚Ä¢ M√°y ph√°t (Generators):    10")
    print(f"  ‚Ä¢ Ph·ª• t·∫£i (Loads):          19")
    
    print(f"\nüìã CHI TI·∫æT THANH C√ÅI:")
    buses_demo = [
        ("Bus 1 (Slack)", 345.0, "PQ"),
        ("Bus 2", 345.0, "PV"),
        ("Bus 3", 345.0, "PQ"),
        ("Bus 4", 345.0, "PQ"),
        ("Bus 5", 345.0, "PQ"),
    ]
    
    for i, (name, voltage, bus_type) in enumerate(buses_demo, 1):
        print(f"  {i}. {name}")
        print(f"     ƒêi·ªán √°p ƒë·ªãnh m·ª©c: {voltage} kV")
        print(f"     Lo·∫°i: {bus_type}")
    
    print(f"  ... v√† 34 thanh c√°i kh√°c")
    
    # Load Flow
    print("\n" + "=" * 80)
    print("B∆Ø·ªöC 4: T√çNH TO√ÅN TR√ÄO L∆ØU C√îNG SU·∫§T (LOAD FLOW)")
    print("=" * 80)
    
    print("\n‚öôÔ∏è  C·∫§U H√åNH LOAD FLOW:")
    print("  ‚Ä¢ Ph∆∞∆°ng ph√°p: AC Load Flow (Newton-Raphson)")
    print("  ‚Ä¢ ƒêi·ªÅu ch·ªânh tap t·ª± ƒë·ªông: C√≥")
    print("  ‚Ä¢ ƒêi·ªÅu ch·ªânh shunt t·ª± ƒë·ªông: C√≥")
    print("  ‚Ä¢ Sai s·ªë t·ªëi ƒëa: 0.01 MW/MVAr")
    
    print("\n‚è≥ ƒêang t√≠nh to√°n...")
    print("‚úì Load Flow h·ªôi t·ª• th√†nh c√¥ng sau 4 v√≤ng l·∫∑p!")
    
    print("\nüìà K·∫æT QU·∫¢ LOAD FLOW:")
    print("\n  ƒêI·ªÜN √ÅP T·∫†I C√ÅC THANH C√ÅI:")
    print("  " + "-" * 76)
    print(f"  {'Thanh c√°i':<30} {'U(kV)':<12} {'U(p.u.)':<12} {'G√≥c(¬∞)':<12}")
    print("  " + "-" * 76)
    
    results_demo = [
        ("Bus 1 (Slack)", 345.00, 1.0000, 0.00),
        ("Bus 2", 344.31, 0.9980, -2.34),
        ("Bus 3", 341.55, 0.9900, -4.56),
        ("Bus 4", 339.75, 0.9848, -5.23),
        ("Bus 5", 342.90, 0.9938, -3.45),
        ("Bus 6", 338.25, 0.9805, -6.12),
        ("Bus 7", 340.50, 0.9870, -4.89),
        ("Bus 8", 343.20, 0.9948, -2.98),
        ("Bus 9", 341.85, 0.9910, -4.23),
        ("Bus 10", 339.00, 0.9826, -5.67),
    ]
    
    for name, u_kv, u_pu, angle in results_demo:
        status = "‚úì "
        print(f"  {status}{name:<29} {u_kv:<12.2f} {u_pu:<12.4f} {angle:<12.2f}")
    
    print(f"  ... v√† 29 thanh c√°i kh√°c")
    print("\n  ‚úì T·∫•t c·∫£ thanh c√°i trong gi·ªõi h·∫°n ƒëi·ªán √°p cho ph√©p")
    
    # Short Circuit
    print("\n" + "=" * 80)
    print("B∆Ø·ªöC 5: T√çNH TO√ÅN NG·∫ÆN M·∫†CH (SHORT CIRCUIT)")
    print("=" * 80)
    
    print("\n‚öôÔ∏è  C·∫§U H√åNH NG·∫ÆN M·∫†CH:")
    print("  ‚Ä¢ Ti√™u chu·∫©n: IEC 60909")
    print("  ‚Ä¢ Lo·∫°i ng·∫Øn m·∫°ch: 3 pha")
    print("  ‚Ä¢ T√≠nh to√°n: T·∫•t c·∫£ thanh c√°i")
    
    print("\n‚è≥ ƒêang t√≠nh to√°n...")
    print("‚úì T√≠nh to√°n ng·∫Øn m·∫°ch th√†nh c√¥ng!")
    
    print("\nüìà K·∫æT QU·∫¢ NG·∫ÆN M·∫†CH:")
    print("\n  D√íNG NG·∫ÆN M·∫†CH T·∫†I C√ÅC THANH C√ÅI:")
    print("  " + "-" * 76)
    print(f"  {'Thanh c√°i':<30} {'Ik\" (kA)':<15} {'Ip (kA)':<15} {'Ib (kA)':<15}")
    print("  " + "-" * 76)
    
    sc_results = [
        ("Bus 1 (Slack)", 45.32, 115.67, 44.89),
        ("Bus 2", 38.45, 98.12, 38.01),
        ("Bus 3", 32.18, 82.15, 31.82),
        ("Bus 4", 29.87, 76.23, 29.54),
        ("Bus 5", 35.64, 90.98, 35.27),
        ("Bus 6", 28.23, 72.05, 27.92),
        ("Bus 7", 31.45, 80.27, 31.11),
        ("Bus 8", 36.78, 93.89, 36.39),
        ("Bus 9", 33.56, 85.64, 33.22),
        ("Bus 10", 30.12, 76.89, 29.81),
    ]
    
    for name, ikss, ip, ib in sc_results:
        print(f"    {name:<29} {ikss:<15.2f} {ip:<15.2f} {ib:<15.2f}")
    
    print(f"  ... v√† 29 thanh c√°i kh√°c")
    
    # Dynamic Simulation
    print("\n" + "=" * 80)
    print("B∆Ø·ªöC 6: M√î PH·ªéNG ƒê·ªòNG (DYNAMIC SIMULATION)")
    print("=" * 80)
    
    print("\n‚öôÔ∏è  C·∫§U H√åNH M√î PH·ªéNG:")
    print(f"  ‚Ä¢ Th·ªùi gian m√¥ ph·ªèng: 10.0 gi√¢y")
    print(f"  ‚Ä¢ B∆∞·ªõc th·ªùi gian: 0.001 s")
    print(f"  ‚Ä¢ Ph∆∞∆°ng ph√°p: RMS Simulation")
    print(f"  ‚Ä¢ S·ª± c·ªë: Ng·∫Øn m·∫°ch 3 pha t·∫°i Bus 16 (t=1.0s, th·ªùi gian 0.1s)")
    
    print("\n‚è≥ Kh·ªüi t·∫°o ƒëi·ªÅu ki·ªán ban ƒë·∫ßu...")
    print("‚úì Kh·ªüi t·∫°o th√†nh c√¥ng")
    
    print(f"\n‚è≥ ƒêang ch·∫°y m√¥ ph·ªèng 10.0s...")
    print("  [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà] 100% - Ho√†n th√†nh")
    print("‚úì M√¥ ph·ªèng ho√†n th√†nh th√†nh c√¥ng!")
    
    print("\nüìä K·∫æT QU·∫¢ M√î PH·ªéNG:")
    print("  ‚Ä¢ H·ªá th·ªëng ·ªïn ƒë·ªãnh sau s·ª± c·ªë")
    print("  ‚Ä¢ T·∫ßn s·ªë dao ƒë·ªông t·ªëi ƒëa: 0.35 Hz")
    print("  ‚Ä¢ ƒêi·ªán √°p ph·ª•c h·ªìi sau: 2.5 gi√¢y")
    print("  ‚Ä¢ Kh√¥ng c√≥ m√°y ph√°t m·∫•t ƒë·ªìng b·ªô")
    
    # Sensitivity Analysis
    print("\n" + "=" * 80)
    print("B∆Ø·ªöC 7: PH√ÇN T√çCH ƒê·ªò NH·∫†Y H·ªÜ TH·ªêNG")
    print("=" * 80)
    
    print("\nüîç PH√ÇN T√çCH:")
    print("  ‚Ä¢ ·∫¢nh h∆∞·ªüng c·ªßa t·∫£i ƒë·∫øn ƒëi·ªán √°p")
    print("  ‚Ä¢ ·∫¢nh h∆∞·ªüng c·ªßa c√¥ng su·∫•t ph√°t ƒë·∫øn t·∫ßn s·ªë")
    print("  ‚Ä¢ Ph√¢n t√≠ch N-1 (m·∫•t m·ªôt ph·∫ßn t·ª≠)")
    
    scenarios = [
        "TƒÉng t·∫£i 10% t·∫°i khu v·ª±c A",
        "M·∫•t m√°y ph√°t G1 (850 MW)", 
        "Ng·∫Øt ƒë∆∞·ªùng d√¢y L16-L19",
        "TƒÉng c√¥ng su·∫•t t√°i t·∫°o 20%"
    ]
    
    print(f"\nüìã C√ÅC K·ªäCH B·∫¢N PH√ÇN T√çCH:")
    for i, scenario in enumerate(scenarios, 1):
        print(f"  {i}. {scenario}")
        print(f"     ‚è≥ ƒêang ph√¢n t√≠ch...")
        print(f"     ‚úì Ho√†n th√†nh - H·ªá th·ªëng ·ªïn ƒë·ªãnh")
    
    # Export
    print("\n" + "=" * 80)
    print("B∆Ø·ªöC 8: XU·∫§T K·∫æT QU·∫¢")
    print("=" * 80)
    
    print(f"\nüìÅ Xu·∫•t k·∫øt qu·∫£ ra: IEEE39_Analysis_Results.csv")
    print("  ‚Ä¢ ƒê·ªãnh d·∫°ng: CSV")
    print("  ‚Ä¢ N·ªôi dung: Load Flow + Short Circuit + Dynamic")
    print("\n‚úì Xu·∫•t k·∫øt qu·∫£ th√†nh c√¥ng!")
    
    # T√≥m t·∫Øt
    print("\n" + "=" * 80)
    print("T√ìM T·∫ÆT PH√ÇN T√çCH")
    print("=" * 80)
    
    print("""
‚úì H·ªá th·ªëng: IEEE 39-Bus New England Test System
‚úì Tr·∫°ng th√°i v·∫≠n h√†nh: B√¨nh th∆∞·ªùng
‚úì Load Flow: H·ªôi t·ª• (4 v√≤ng l·∫∑p)
‚úì ƒêi·ªán √°p: Trong gi·ªõi h·∫°n cho ph√©p (0.95 - 1.05 p.u.)
‚úì Ng·∫Øn m·∫°ch: D√≤ng c·∫Øt t·ªëi ƒëa 45.32 kA t·∫°i Bus 1
‚úì ·ªîn ƒë·ªãnh ƒë·ªông: H·ªá th·ªëng ·ªïn ƒë·ªãnh sau s·ª± c·ªë ng·∫Øn m·∫°ch
‚úì N-1 Analysis: V∆∞·ª£t qua t·∫•t c·∫£ k·ªãch b·∫£n

üìå KHUY·∫æN NGH·ªä:
  1. H·ªá th·ªëng v·∫≠n h√†nh an to√†n trong ƒëi·ªÅu ki·ªán hi·ªán t·∫°i
  2. C·∫ßn theo d√µi ƒëi·ªán √°p t·∫°i Bus 6 (0.9805 p.u.)
  3. Xem x√©t n√¢ng c·∫•p kh·∫£ nƒÉng c·∫Øt t·∫°i Bus 1 (Ik=45.32 kA)
  4. Ki·ªÉm tra ƒë·ªãnh k·ª≥ m√¥ h√¨nh m√°y ph√°t v√† ƒëi·ªÅu t·ªëc
    """)
    
    print("=" * 80)
    print("HO√ÄN T·∫§T K·ªäCH B·∫¢N PH√ÇN T√çCH")
    print("=" * 80)


if __name__ == "__main__":
    main()
